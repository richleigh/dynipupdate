version: '3.8'

services:
  # DNS updater - run on every host/container
  dynip-updater:
    build: .
    container_name: dynip-updater
    env_file: .env
    network_mode: host  # Required for accurate internal IP detection
    restart: unless-stopped

    # Run every 5 minutes (300 seconds)
    entrypoint: |
      sh -c 'while true; do /dynipupdate; sleep 300; done'

  # DNS cleanup service - run ONCE per environment (not per host)
  # Uncomment to enable automatic cleanup of stale DNS records
  # dynip-cleanup:
  #   build: .
  #   container_name: dynip-cleanup
  #   env_file: .env
  #   restart: unless-stopped
  #   command: ["-cleanup"]
